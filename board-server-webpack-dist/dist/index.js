(()=>{"use strict";var e={183:(e,t,o)=>{o.r(t),o.d(t,{default:()=>r});const r=o.p+"8239ad125e42bef4f510f3de4b0d5f26.json"},752:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=r(o(127)),n=r(o(473)),i=o(274),c=s(o(677)),u=r(o(712)),l=r(o(150)),d=r(o(334)),f=r(o(747)),p=r(o(358)),_=r(o(57)),E=r(o(622)),m=r(o(479)),T=r(o(554)),O=s(o(912)),h=r(o(289));t.app=a.default(),d.default.config(),t.app.use(n.default.urlencoded({extended:!0})),t.app.use(n.default.json()),t.app.use(T.default().getIpInfoMiddleware),t.app.use(p.default(process.env.COOKIE_SECRET));const R={resave:!1,saveUninitialized:!1,secret:process.env.COOKIE_SECRET,cookie:{httpOnly:!0,secure:!1}},y=_.default(R);t.app.use(y);try{f.default.readdirSync("resources")}catch(e){O.default.info("resources is null directory, now mkdir"),f.default.mkdirSync("resources")}t.app.set("view engine","html"),t.app.use(a.default.static(E.default.join(__dirname,"./www"))),t.app.use("/img",a.default.static(E.default.join(__dirname,"resources"))),l.default.token("date",(()=>h.default().tz("Asia/Seoul").format())),t.app.use(l.default(':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :response-time ms :res[content-length] ":referrer" ":user-agent"',{stream:O.stream})),t.app.use(l.default("combined")),t.app.set("port",process.env.PORT||8080),t.app.set("host",`${process.env.HOST}`||"localhost"),O.default.info(`port set : ${t.app.get("port")}, host set : ${t.app.get("host")}`);const{sequelize:g}=o(4);g.sync({force:!1}).then((()=>{O.default.info("Connect MariaDB!")})).catch((e=>{O.default.error("[Error] Connect MariaDB",e)})),t.app.use(m.default()),console.log(E.default.join(__dirname,"resources"));try{var N=o(183),v=u.default.readFileSync(`./dist/${N.default}`);t.app.use("/swagger",c.serve,c.setup(v)),O.default.info("Swagger config success : production mode")}catch(e){O.default.error("[Error] Fail to swagger config",e)}i.RegisterRoutes(t.app),t.app.get("/",((e,t)=>{t.sendFile(E.default.join(__dirname,"./www","index.html"))}))},528:function(e,t,o){var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0}),r(o(334)).config();const s={development:{username:process.env.DB_USERNAME||"root",password:process.env.DB_PASSWORD||"root",database:process.env.DATABASE_NAME||"board-system",host:process.env.DB_HOST||"127.0.0.1",dialect:"mysql",dialectOptions:{charset:"utf8mb4",dateStrings:!0,typeCast:!0},timezone:"+09:00"},test:{username:process.env.DB_USERNAME||"root",password:process.env.DB_PASSWORD||"root",database:process.env.DATABASE_NAME||"board-system",host:process.env.DB_HOST||"127.0.0.1",dialect:"mysql",dialectOptions:{charset:"utf8mb4",dateStrings:!0,typeCast:!0},timezone:"+09:00"},production:{username:process.env.DB_USERNAME||"root",password:process.env.DB_PASSWORD||"root",database:process.env.DATABASE_NAME||"board-system",host:process.env.DB_HOST||"localhost",port:process.env.DB_PORT||3306,dialect:"mysql",dialectOptions:{charset:"utf8mb4",dateStrings:!0,typeCast:!0},timezone:"+09:00"}};t.default=s},912:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=r(o(927)),n=s(o(944)),i=r(o(876)),c=r(o(510)),u=r(o(289)),l=new Date,d=(l.getFullYear(),l.getMonth(),l.getMonth(),l.getDate(),l.getDate(),n.format(((e,t)=>(t.tz&&(e.timestamp=u.default().tz(t.tz).format()),e)))),f={file:{level:"info",dirname:`${a.default}/log`,filename:"app.log",handleExceptions:!0,json:!1,maxsize:5242880,maxFiles:"30d",colorize:!1},console:{level:"debug",handleExceptions:!0,timestamp:()=>u.default().format("YYYY-MM-DD hh:mm:ss"),json:!0,colorize:!0,format:n.format.combine(d({tz:"Asia/Seoul"}),n.format.json(),n.format.printf((e=>`${e.timestamp} - ${e.level} [${process.pid}]: ${e.message}`)))}},p=n.createLogger({transports:[new c.default(f.file),new n.default.transports.Console(f.console)],exitOnError:!1,format:n.format.combine(d({tz:"Asia/Seoul"}),n.format.json(),n.format.printf((e=>`${e.timestamp} - ${e.level} [${process.pid}]: ${e.message}`)))}),_=i.default().on("data",(e=>{p.info(`pid-${process.pid}- ${e}`)}));t.stream=_,t.default=p},590:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var s,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(n=(a<3?s(n):a>3?s(t,o,n):s(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(83),c=o(359),u=n(o(238)),l=n(o(891)),d=n(o(912));let f=class extends i.Controller{token_issue(e,t){return new Promise(((e,o)=>{const{clientSecret:r}=t;c.get_token(r).then((t=>{console.log(t),t.code===u.default.UNAUTHORIZED&&this.setStatus(u.default.UNAUTHORIZED),e(t)})).catch((e=>{console.log(e),o(e)}))})).catch((e=>(d.default.error(`[POST] [auth] [token] Failed to get token: ${e.message}`),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:l.default.ERROR_CODE_OTHER})))}};r([i.Post("token"),a(0,i.Request()),a(1,i.Body()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],f.prototype,"token_issue",null),f=r([i.Route("auth")],f),t.AuthController=f},38:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var s,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(n=(a<3?s(n):a>3?s(t,o,n):s(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}},n=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=o(83),u=o(666),l=i(o(238)),d=i(o(891)),f=i(o(912));let p=class extends c.Controller{select_list(e,t,o,r){return new Promise(((e,s)=>{u.selectList({page:t,pageSize:o,maxSize:r}).then((t=>{f.default.info("[GET] [board] select list"),e(t)})).catch((e=>{s(e)}))})).catch((e=>(f.default.error(`[GET] [board] Failed to select one: ${e.message}`),this.setStatus(l.default.INTERNAL_SERVER_ERROR),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:d.default.ERROR_CODE_OTHER})))}select_one(e,t){return new Promise(((e,o)=>{u.selectOne(t).then((o=>{f.default.info(`[GET] [board] [${t}] select one`),e(o)})).catch((e=>{o(e)}))})).catch((e=>(f.default.error(`[GET] [board] [${t}] Failed to select one: ${e.message}`),this.setStatus(l.default.INTERNAL_SERVER_ERROR),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:d.default.ERROR_CODE_OTHER})))}insert_board(e,t){return new Promise(((e,o)=>n(this,void 0,void 0,(function*(){u.insert(t).then((t=>{f.default.info("[POST] [board] insert board"),e(t)})).catch((e=>{o(e)}))})))).catch((e=>(f.default.error(`[POST] [board] Failed to insert board: ${e.message}`),this.setStatus(l.default.INTERNAL_SERVER_ERROR),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:d.default.ERROR_CODE_OTHER})))}};r([c.Security("jwt",[]),c.Get(),a(0,c.Request()),a(1,c.Query()),a(2,c.Query()),a(3,c.Query()),s("design:type",Function),s("design:paramtypes",[Object,Number,Number,Number]),s("design:returntype",Promise)],p.prototype,"select_list",null),r([c.Security("jwt",[]),c.Get("{id}"),a(0,c.Request()),a(1,c.Path()),s("design:type",Function),s("design:paramtypes",[Object,Number]),s("design:returntype",Promise)],p.prototype,"select_one",null),r([c.Security("jwt",[]),c.Post(),a(0,c.Request()),a(1,c.Body()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],p.prototype,"insert_board",null),p=r([c.Route("board")],p),t.BoardController=p},861:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var s,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(n=(a<3?s(n):a>3?s(t,o,n):s(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(83),c=o(791),u=n(o(891)),l=n(o(912));let d=class extends i.Controller{insert(e,t){return new Promise(((e,o)=>{const{host:r}=t;c.insertDomain(r).then((t=>{l.default.info("[POST] [domain] insert domain"),e(t)})).catch((e=>{console.log(e),o(e)}))})).catch((e=>(l.default.error(`[POST] [domain] Failed to insert domain: ${e.message}`),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:u.default.ERROR_CODE_OTHER})))}select_all(e){return new Promise(((e,t)=>{c.selectAllDomain().then((t=>{l.default.info("[GET] [domain] selectAll domain"),e(t)})).catch((e=>{console.log(e),t(e)}))})).catch((e=>(l.default.error(`[GET] [domain] Failed to selectAll domain: ${e.message}`),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:u.default.ERROR_CODE_OTHER})))}};r([i.Post(),a(0,i.Request()),a(1,i.Body()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],d.prototype,"insert",null),r([i.Get(),a(0,i.Request()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],d.prototype,"select_all",null),d=r([i.Route("domain")],d),t.DomainController=d},98:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var s,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(n=(a<3?s(n):a>3?s(t,o,n):s(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}},n=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=o(83),u=i(o(238)),l=i(o(891)),d=o(194),f=i(o(747)),p=i(o(912));let _=class extends c.Controller{insert(e){return new Promise(((t,o)=>n(this,void 0,void 0,(function*(){const r=yield d.handleFile(e);console.log(r.resource);const s=`${r.resource.path}`,a=`${r.resource.originalname}`,n=r.resource.size,i=`${r.resource.filename}`,c=`${r.resource.mimetype}`;d.insertResource({originName:a,fileSize:n,savedFileName:i,path:s,mimeType:c}).then((e=>{p.default.info("[POST] [resource] [single] insert resource"),t(e)})).catch((e=>{console.log(e),o(e)}))})))).catch((e=>(p.default.error(`[POST] [resource] [single] Faild to insert resource : ${e.message}`),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:l.default.ERROR_CODE_OTHER})))}getImage(e,t){return new Promise(((o,r)=>n(this,void 0,void 0,(function*(){d.selectOne(t).then((o=>n(this,void 0,void 0,(function*(){if(0==o.success)return void r(`${l.default.ERROR_CODE_DATA_NOT_EXIST}File not exist.`);const s=o.data.path,a=o.data.mimeType,n=e.res;n.setHeader("Content-Type",a),n.setHeader("Content-Disposition",`attachment; filename=${encodeURI(o.data.originName)}`);const i=f.default.createReadStream(s);return i.pipe(n),yield i.on("end",(()=>{p.default.info(`[GET] [resource] [image] [id : ${t}] get image resource`),n.end()}))})))).catch((e=>{console.log(e),r(e)}))})))).catch((e=>(p.default.error(`[GET] [resource] [image] [id : ${t}] Faild to get image resource : ${e.message}`),this.setStatus(u.default.INTERNAL_SERVER_ERROR),{success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:l.default.ERROR_CODE_OTHER})))}};r([c.Post("single"),a(0,c.Request()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],_.prototype,"insert",null),r([c.Get("/image"),a(0,c.Request()),a(1,c.Query()),s("design:type",Function),s("design:paramtypes",[Object,Number]),s("design:returntype",Promise)],_.prototype,"getImage",null),_=r([c.Route("resource")],_),t.ResourceController=_},891:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={ERROR_CODE_OTHER:"[000]",ERROR_CODE_DATA_NOT_EXIST:"[404]",ERROR_CODE_AUTH_FAILED:"[500]",RESOURCE_PATH:"resources/",RESOURCE_CLIENT_PATH:"/img/",RESOURCE_MAX_SIZE:5242880}},238:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CONTINUE=100]="CONTINUE",e[e.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",e[e.PROCESSING=102]="PROCESSING",e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.RESET_CONTENT=205]="RESET_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.MULTI_STATUS=207]="MULTI_STATUS",e[e.ALREADY_REPORTED=208]="ALREADY_REPORTED",e[e.IM_USED=226]="IM_USED",e[e.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",e[e.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",e[e.FOUND=302]="FOUND",e[e.SEE_OTHER=303]="SEE_OTHER",e[e.NOT_MODIFIED=304]="NOT_MODIFIED",e[e.USE_PROXY=305]="USE_PROXY",e[e.SWITCH_PROXY=306]="SWITCH_PROXY",e[e.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",e[e.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",e[e.URI_TOO_LONG=414]="URI_TOO_LONG",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",e[e.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",e[e.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",e[e.LOCKED=423]="LOCKED",e[e.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",e[e.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",e[e.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",e[e.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",e[e.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",e[e.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",e[e.LOOP_DETECTED=508]="LOOP_DETECTED",e[e.NOT_EXTENDED=510]="NOT_EXTENDED",e[e.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"}(o||(o={})),t.default=o},812:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(121),s=o(872);class a extends r.Model{}a.init({title:{type:r.DataTypes.STRING(200),allowNull:!0},content:{type:r.DataTypes.TEXT,allowNull:!0},nick:{type:r.DataTypes.STRING(200),allowNull:!0},ridx:{type:r.DataTypes.INTEGER,allowNull:!0}},{sequelize:s.sequelize,modelName:"Board",tableName:"boards",charset:"utf8",collate:"utf8_general_ci"}),t.associate=e=>{},t.default=a},142:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(121),s=o(872);class a extends r.Model{}a.init({host:{type:r.DataTypes.STRING(80),allowNull:!1},clientSecret:{type:r.DataTypes.UUID,allowNull:!1}},{sequelize:s.sequelize,modelName:"Domain",tableName:"domains",charset:"utf8",collate:"utf8_general_ci"}),t.associate=e=>{},t.default=a},4:function(e,t,o){var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(872));const s=r(o(142)),a=r(o(812)),n={Domain:s.default,Board:a.default};s.associate(n),a.associate(n)},378:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(121),s=o(872);class a extends r.Model{}a.init({path:{type:r.DataTypes.STRING(300)},originName:{type:r.DataTypes.STRING(200)},savedFileName:{type:r.DataTypes.STRING(200)},fileSize:{type:r.DataTypes.INTEGER},mimeType:{type:r.DataTypes.STRING(200)}},{sequelize:s.sequelize,modelName:"Resource",tableName:"resources",charset:"utf8",collate:"utf8_general_ci"}),t.associate=e=>{},t.default=a},872:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(121),a=r(o(528)),n="production",{database:i,username:c,password:u}=a.default[n],l=new s.Sequelize(i,c,u,a.default[n]);t.sequelize=l,t.default=l},274:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(83),s=o(590),a=o(38),n=o(861),i=o(98),c=o(287),u=new r.ValidationService({JwtAuthModel:{dataType:"refObject",properties:{code:{dataType:"double",required:!0},message:{dataType:"string",required:!0},token:{dataType:"any"}},additionalProperties:!0},ResponseModel:{dataType:"refObject",properties:{success:{dataType:"boolean",required:!0},message:{dataType:"string",required:!0},data:{dataType:"any",required:!0},code:{dataType:"double",required:!0}},additionalProperties:!0},BoardFormModel:{dataType:"refObject",properties:{id:{dataType:"double"},title:{dataType:"string"},content:{dataType:"string"},nick:{dataType:"string"},ridx:{dataType:"double"}},additionalProperties:!0},DomainModel:{dataType:"refObject",properties:{id:{dataType:"double",required:!0},host:{dataType:"string",required:!0},clientSecret:{dataType:"string"}},additionalProperties:!0}});t.RegisterRoutes=function(e){function t(e=[]){return(t,o,r)=>{let s=0,a=!1;const n=function(e){a||(a=!0,s++,t.user=e,r())},i=function(t){s++,s!=e.length||a||(t.status=t.status||401,r(t))};for(const o of e)if(Object.keys(o).length>1){let e=[];for(const r in o)e.push(c.expressAuthentication(t,r,o[r]));Promise.all(e).then((e=>{n(e[0])})).catch(i)}else for(const e in o)c.expressAuthentication(t,e,o[e]).then(n).catch(i)}}function o(e,t,o,r){return Promise.resolve(t).then((t=>{let r;if("getHeaders"in(s=e)&&"getStatus"in s&&"setStatus"in s){const t=e.getHeaders();Object.keys(t).forEach((e=>{o.set(e,t[e])})),r=e.getStatus()}var s;t&&"function"==typeof t.pipe&&t.readable&&"function"==typeof t._read?t.pipe(o):t||!1===t?o.status(r||200).json(t):o.status(r||204).end()})).catch((e=>r(e)))}function l(e,t){const o={},s=Object.keys(e).map((r=>{const s=e[r].name;switch(e[r].in){case"request":return t;case"query":return u.ValidateParam(e[r],t.query[s],s,o,void 0,{controllerPathGlobs:["./src/controller/*.controller.ts"],specVersion:3});case"path":return u.ValidateParam(e[r],t.params[s],s,o,void 0,{controllerPathGlobs:["./src/controller/*.controller.ts"],specVersion:3});case"header":return u.ValidateParam(e[r],t.header(s),s,o,void 0,{controllerPathGlobs:["./src/controller/*.controller.ts"],specVersion:3});case"body":return u.ValidateParam(e[r],t.body,s,o,s+".",{controllerPathGlobs:["./src/controller/*.controller.ts"],specVersion:3});case"body-prop":return u.ValidateParam(e[r],t.body[s],s,o,"body.",{controllerPathGlobs:["./src/controller/*.controller.ts"],specVersion:3})}}));if(Object.keys(o).length>0)throw new r.ValidateError(o,"");return s}e.post("/api/v1/auth/token",(function(e,t,r){const a={req:{in:"request",name:"req",required:!0,dataType:"object"},body:{in:"body",name:"body",required:!0,dataType:"any"}};let n=[];try{n=l(a,e)}catch(e){return r(e)}const i=new s.AuthController,c=i.token_issue.apply(i,n);o(i,c,t,r)})),e.get("/api/v1/board",t([{jwt:[]}]),(function(e,t,r){const s={req:{in:"request",name:"req",required:!0,dataType:"object"},page:{in:"query",name:"page",required:!0,dataType:"double"},pageSize:{in:"query",name:"pageSize",required:!0,dataType:"double"},maxSize:{in:"query",name:"maxSize",required:!0,dataType:"double"}};let n=[];try{n=l(s,e)}catch(e){return r(e)}const i=new a.BoardController,c=i.select_list.apply(i,n);o(i,c,t,r)})),e.get("/api/v1/board/:id",t([{jwt:[]}]),(function(e,t,r){const s={req:{in:"request",name:"req",required:!0,dataType:"object"},id:{in:"path",name:"id",required:!0,dataType:"double"}};let n=[];try{n=l(s,e)}catch(e){return r(e)}const i=new a.BoardController,c=i.select_one.apply(i,n);o(i,c,t,r)})),e.post("/api/v1/board",t([{jwt:[]}]),(function(e,t,r){const s={req:{in:"request",name:"req",required:!0,dataType:"object"},form:{in:"body",name:"form",required:!0,ref:"BoardFormModel"}};let n=[];try{n=l(s,e)}catch(e){return r(e)}const i=new a.BoardController,c=i.insert_board.apply(i,n);o(i,c,t,r)})),e.post("/api/v1/domain",(function(e,t,r){const s={req:{in:"request",name:"req",required:!0,dataType:"object"},form:{in:"body",name:"form",required:!0,ref:"DomainModel"}};let a=[];try{a=l(s,e)}catch(e){return r(e)}const i=new n.DomainController,c=i.insert.apply(i,a);o(i,c,t,r)})),e.get("/api/v1/domain",(function(e,t,r){const s={req:{in:"request",name:"req",required:!0,dataType:"object"}};let a=[];try{a=l(s,e)}catch(e){return r(e)}const i=new n.DomainController,c=i.select_all.apply(i,a);o(i,c,t,r)})),e.post("/api/v1/resource/single",(function(e,t,r){const s={req:{in:"request",name:"req",required:!0,dataType:"object"}};let a=[];try{a=l(s,e)}catch(e){return r(e)}const n=new i.ResourceController,c=n.insert.apply(n,a);o(n,c,t,r)})),e.get("/api/v1/resource/image",(function(e,t,r){const s={request:{in:"request",name:"request",required:!0,dataType:"object"},id:{in:"query",name:"id",required:!0,dataType:"double"}};let a=[];try{a=l(s,e)}catch(e){return r(e)}const n=new i.ResourceController,c=n.getImage.apply(n,a);o(n,c,t,r)}))}},728:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(o(912)),a=o(752);a.app.listen(a.app.get("port"),(()=>s.default.info(`Example app listening at http://${a.app.get("host")}:${a.app.get("port")}`)))},287:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(o(722)),a=r(o(912)),n=r(o(891)),i=r(o(238));t.expressAuthentication=function(e,o,r){const s=e.res;switch(o){case"jwt":return t.jwtAuth(e,s,r);default:return t.noneAuth(e,s)}},t.jwtAuth=(e,t,o,r)=>new Promise(((t,o)=>{try{const i=(e.get("Authorization")||"Bearer ").split("Bearer ")[1]||r,c=`${process.env.JWT_SECRET}`;s.default.verify(i,c)?(a.default.info(`Token Auth Success : ${i}`),t({})):o(new Error(`${n.default.ERROR_CODE_AUTH_FAILED}Empty decoded refresh token.`))}catch(e){console.log(e),o(e)}})).catch((e=>{if("TokenExpiredError"==e.name)return a.default.info(`Token Auth Faild, Token Expired : ${e.message}`),t.status(419),void t.send({success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:n.default.ERROR_CODE_OTHER});a.default.warn(`Token Auth Faild, Unauthorized : ${e.message}`),t.status(i.default.UNAUTHORIZED),t.send({success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:n.default.ERROR_CODE_OTHER})})),t.noneAuth=(e,t)=>new Promise(((e,t)=>{e({})})).catch((e=>{t.status(i.default.UNAUTHORIZED),t.send({success:!1,message:e.message,code:e.message.match(/(\[[0-9]{3}\])(\w+)/)&&3===e.message.match(/(\[[0-9]{3}\])(\w+)/).length?e.message.match(/(\[[0-9]{3}\])(\w+)/)[1]:n.default.ERROR_CODE_OTHER})}))},666:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(o(812)),n=s(o(238));t.selectList=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){const r=e.page||1,s=(r-1)*e.pageSize,i=yield a.default.count();try{const o=yield a.default.findAll({order:[["createdAt","DESC"]],limit:e.pageSize,offset:s});o.length<=0&&t({success:!0,message:"결과가 존재하지 않습니다.",data:null,code:n.default.NO_CONTENT}),t({success:!0,message:"게시물 목록을 불러왔습니다.",data:{list:o,pager:{collectionSize:i,page:r,maxSize:e.maxSize,pageSize:e.pageSize}},code:n.default.OK})}catch(e){o(e)}}))))})),t.selectOne=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){try{const o=yield a.default.findOne({where:{id:e}});o&&(console.log(o),t({success:!0,message:"불러오기 성공",data:o,code:n.default.OK})),t({success:!0,message:"결과가 존재하지 않습니다.",data:null,code:n.default.NO_CONTENT})}catch(e){o(e)}}))))})),t.insert=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){try{const{title:o,content:r,nick:s,ridx:i}=e;yield a.default.create({title:o,content:r,nick:s,ridx:i}),t({success:!0,message:"게시 성공",data:null,code:n.default.OK})}catch(e){console.error(e),o(e)}}))))}))},791:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(o(142)),n=o(231),i=s(o(238));t.insertDomain=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){try{const o=yield a.default.findOne({where:{host:e}});console.log(o),o&&t({success:!1,message:"Exist Host",code:412});const r=n.v4();yield a.default.create({host:e,clientSecret:r}),t({success:!0,message:"Insert Host Complete",code:200})}catch(e){console.error(e),o(e)}}))))})),t.selectAllDomain=()=>r(void 0,void 0,void 0,(function*(){return new Promise(((e,t)=>r(void 0,void 0,void 0,(function*(){try{const t=yield a.default.findAll({});e({success:!0,message:"도메인 목록을 불러왔습니다.",data:{list:t},code:i.default.OK})}catch(e){t(e)}}))))}))},194:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(o(238)),n=s(o(378)),i=s(o(891)),c=s(o(633));t.insertResource=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){try{const o=yield n.default.create({path:e.path,originName:e.originName,savedFileName:e.savedFileName,fileSize:e.fileSize,mimeType:e.mimeType});t({success:!0,message:"리소스 저장 성공",data:{id:o.id},code:a.default.OK})}catch(e){o(e)}}))))})),t.handleFile=e=>(console.log("handling"),new Promise(((t,o)=>{try{c.default({dest:i.default.RESOURCE_PATH,limits:{fileSize:i.default.RESOURCE_MAX_SIZE}}).single("file")(e,void 0,(s=>r(void 0,void 0,void 0,(function*(){if(s)return console.log(s),void o(s);t({form:e.body,resource:e.file})}))))}catch(e){o(e)}})).catch((e=>e))),t.selectOne=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){try{const o=yield n.default.findOne({where:{id:e}});o&&t({success:!0,message:"불러오기 성공",data:o,code:a.default.OK}),t({success:!1,message:"결과가 존재하지 않습니다.",data:null,code:a.default.NO_CONTENT})}catch(e){o(e)}}))))}))},359:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(o(142)),n=s(o(238)),i=s(o(722));t.get_token=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>r(void 0,void 0,void 0,(function*(){try{let o;(yield a.default.findOne({where:{clientSecret:e}}))||t({code:n.default.UNAUTHORIZED,message:"토큰 발급 실패"}),o=process.env.JWT_SECRET;const r=i.default.sign({name:"sjh"},o,{expiresIn:process.env.TOKEN_EXPIRED_TIME||"1m",issuer:"board-service"});t({code:n.default.OK,message:"토큰이 발급되었습니다",token:r})}catch(e){console.error(e),o(e)}}))))}))},927:e=>{e.exports=require("app-root-path")},473:e=>{e.exports=require("body-parser")},358:e=>{e.exports=require("cookie-parser")},479:e=>{e.exports=require("cors")},334:e=>{e.exports=require("dotenv")},127:e=>{e.exports=require("express")},554:e=>{e.exports=require("express-ip")},57:e=>{e.exports=require("express-session")},747:e=>{e.exports=require("fs")},712:e=>{e.exports=require("jsonfile")},722:e=>{e.exports=require("jsonwebtoken")},289:e=>{e.exports=require("moment-timezone")},150:e=>{e.exports=require("morgan")},633:e=>{e.exports=require("multer")},622:e=>{e.exports=require("path")},121:e=>{e.exports=require("sequelize")},876:e=>{e.exports=require("split")},677:e=>{e.exports=require("swagger-ui-express")},83:e=>{e.exports=require("tsoa")},231:e=>{e.exports=require("uuid")},944:e=>{e.exports=require("winston")},510:e=>{e.exports=require("winston-daily-rotate-file")}},t={};function o(r){if(t[r])return t[r].exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,o),s.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="",o(728)})();
//# sourceMappingURL=index.js.map